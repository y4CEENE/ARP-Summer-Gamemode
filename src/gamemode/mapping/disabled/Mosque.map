#include <YSI\y_hooks>

static SalatState[MAX_PLAYERS];

CMD:salat(playerid, param[])
{
    if(SalatState[playerid] > 0)
    {
        return SendClientMessage(playerid, COLOR_GREY, "You are already in salat.");
    }
    if(!IsPlayerInRangeOfPoint(playerid, 20.0, 170.6237,-1646.4669,16.2240))
    {
        return SendClientMessage(playerid, COLOR_GREY, "You are not at mosque!");
    }
    if(GetPlayerWeapon(playerid) > 0)
    {
        return SendClientMessage(playerid, COLOR_GREY, "You cannot do that with a weapon in your hand.");
    }
    if(GetPVarInt(playerid, "PlayerCuffed") != 0 || GetPVarInt(playerid, "Injured") == 1 || GetPVarInt(playerid, "IsFrozen") == 1 || GetPVarInt(playerid, "EventAnims") == 1)
	{
   		return SendClientMessage(playerid, COLOR_GREY, "You can't do that at this time!");
	}
    if(IsPlayerInAnyVehicle(playerid) == 1)
    {
		return SendClientMessage(playerid, COLOR_GREY, "You can't do that in a vehicle.");
	}

    SalatState[playerid] = 1;
    
    SetPlayerFacingAngle(playerid, 132.8508);

	if(GetPlayerAnimationIndex(playerid) != 0) 
    {
        ClearAnimations(playerid);
    }
    TogglePlayerControllableEx(playerid, false);
    SetPlayerSpecialAction(playerid,SPECIAL_ACTION_HANDSUP);
    SetTimerEx("SalatStateChange", 1000, false, "i", playerid);

    return 1;
}
forward SalatStateChange(playerid);
public SalatStateChange(playerid)
{
    if(SalatState[playerid] == 0)
    {
        return 1;
    }
	if(GetPlayerAnimationIndex(playerid) != 0) 
    {
        ClearAnimations(playerid);
    }

    SalatState[playerid]++;

    switch(SalatState[playerid] - 1)
    {
        case 1: 
        {
            ApplyAnimation(playerid, "GRAVEYARD", "mrnM_loop", 4.0, 1, 0, 0, 0, 0, 1);
            SetTimerEx("SalatStateChange", 6000, false, "i", playerid);
        }
        case 2: 
        {
            ApplyAnimation(playerid, "FAT", "IDLE_tired", 4.0, 1, 0, 0, 0, 0, 1);
            SetTimerEx("SalatStateChange", 4000, false, "i", playerid);
        }
        case 3: 
        {
            ApplyAnimation(playerid, "GRAVEYARD", "mrnM_loop", 4.0, 1, 0, 0, 0, 0, 1);
            SetTimerEx("SalatStateChange", 2000, false, "i", playerid);
        }
        case 4: 
        {
            ApplyAnimation(playerid, "MEDIC", "CPR", 4.0, 0, 0, 0, 0, 0, 1);
            SetTimerEx("SalatStateChange", 4000, false, "i", playerid);
        }
        case 5: 
        {
            ApplyAnimation(playerid, "GRAVEYARD", "mrnM_loop", 4.0, 1, 0, 0, 0, 0, 1);
            SetTimerEx("SalatStateChange", 6000, false, "i", playerid);
        }
        case 6: 
        {
            ApplyAnimation(playerid, "FAT", "IDLE_tired", 4.0, 1, 0, 0, 0, 0, 1);
            SetTimerEx("SalatStateChange", 4000, false, "i", playerid);
        }
        case 7: 
        {
            ApplyAnimation(playerid, "GRAVEYARD", "mrnM_loop", 4.0, 1, 0, 0, 0, 0, 1);
            SetTimerEx("SalatStateChange", 2000, false, "i", playerid);
        }
        case 8: 
        {
            ApplyAnimation(playerid, "MEDIC", "CPR", 4.0, 0, 0, 0, 0, 0, 1);
            SetTimerEx("SalatStateChange", 4000, false, "i", playerid);
        }
        case 9:
        {
            SalatState[playerid] = 0;
            TogglePlayerControllableEx(playerid, true);
            PlayerData[playerid][pNotoriety] -= 500;
            if(PlayerData[playerid][pNotoriety] < 0)
            {
                PlayerData[playerid][pNotoriety] = 0;
            }
            SendClientMessageEx(playerid, COLOR_AQUA, "You lost 500 notorious and now you have %d.", PlayerData[playerid][pNotoriety]);
        }
        default:
        {
            SalatState[playerid] = 0;
        }
    }
    return 1;
}

hook OnRemoveBuildings(playerid)
{
    SalatState[playerid] = 0;
    
    CreateDynamicPickup(1240, 1, 171.3288,-1647.7844,16.2240);
    CreateDynamic3DTextLabel("/salat\nto decrease your notority.", COLOR_DOCTOR, 171.3288,-1647.7844,16.2240, 10.0);

    RemoveBuildingForPlayer(playerid, 733, 154.0078, -1716.6484, 5.7031, 0.25);
    RemoveBuildingForPlayer(playerid, 726, 134.1641, -1646.3828, 9.9922, 0.25);
    RemoveBuildingForPlayer(playerid, 733, 203.6563, -1689.2109, 8.2188, 0.25);
    RemoveBuildingForPlayer(playerid, 6430, 121.0313, -1580.4063, 10.4688, 0.25);
    RemoveBuildingForPlayer(playerid, 6421, 137.3984, -1711.5859, 10.4141, 0.25);
    RemoveBuildingForPlayer(playerid, 620, 132.1406, -1698.4219, 7.9375, 0.25);
    RemoveBuildingForPlayer(playerid, 1297, 123.8281, -1694.0156, 11.9531, 0.25);
    RemoveBuildingForPlayer(playerid, 1297, 112.7344, -1685.1406, 12.1094, 0.25);
    RemoveBuildingForPlayer(playerid, 621, 126.6875, -1679.0547, 8.4531, 0.25);
    RemoveBuildingForPlayer(playerid, 620, 158.6563, -1651.8672, 10.9453, 0.25);
    RemoveBuildingForPlayer(playerid, 6431, 233.8828, -1680.0703, 10.5469, 0.25);
    RemoveBuildingForPlayer(playerid, 620, 182.2969, -1642.1172, 12.5625, 0.25);
    return 1;
}

hook OnGameModeInit()
{
    CreateDynamicObject(5710, 176.26891, -1644.32324, 18.66751,   0.00000, 0.00000, 39.00000);
    CreateDynamicObject(8882, 146.12003, -1668.18823, 41.79218,   0.00000, 0.00000, 249.17023);
    CreateDynamicObject(621, 135.31058, -1621.38525, 10.49137,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(620, 158.67143, -1618.28125, 12.53636,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(726, 147.55780, -1608.67993, 11.43329,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(3759, 194.64380, -1664.46472, 16.18230,   0.00000, 0.00000, 170.00000);
    CreateDynamicObject(620, 188.54543, -1652.46033, 13.34725,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(621, 171.01782, -1630.73096, 13.57306,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(869, 186.47127, -1649.92700, 13.99361,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(3520, 188.01672, -1646.02966, 13.25084,   0.00000, 0.00000, 310.77768);
    CreateDynamicObject(3520, 188.65781, -1654.36621, 13.16021,   0.00000, 0.00000, 41.64481);
    CreateDynamicObject(3520, 191.23114, -1658.15381, 13.00273,   0.00000, 0.00000, 215.65495);
    CreateDynamicObject(3520, 186.71338, -1649.75854, 13.08723,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(869, 172.33803, -1633.31628, 14.10105,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(3520, 167.39563, -1628.34375, 12.84895,   0.00000, 0.00000, 38.17005);
    CreateDynamicObject(3520, 177.02461, -1632.52820, 13.23396,   0.00000, 0.00000, 312.30322);
    CreateDynamicObject(3520, 172.45264, -1632.45618, 13.29253,   0.00000, 0.00000, 63.16018);
    CreateDynamicObject(3520, 165.79167, -1625.74524, 12.95153,   0.00000, 0.00000, 50.04649);
    CreateDynamicObject(3520, 168.86577, -1627.69128, 12.98108,   0.00000, 0.00000, 40.12595);
    CreateDynamicObject(1536, 193.95590, -1661.33838, 12.85590,   0.00000, 0.00000, 351.00000);
    CreateDynamicObject(3852, 194.71220, -1660.30212, 11.44480,   5.00000, 0.00000, 81.58960);
    CreateDynamicObject(681, 189.86345, -1654.75659, 13.22587,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(679, 187.75037, -1647.53455, 13.48135,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(679, 186.27985, -1650.94202, 13.56027,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(754, 159.86533, -1627.84412, 12.12833,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(754, 158.41277, -1629.02539, 12.01939,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(760, 156.40385, -1631.07275, 12.19849,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(760, 154.10742, -1635.01672, 12.12755,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(760, 154.83501, -1632.89026, 12.04534,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1232, 176.10542, -1634.79285, 14.82178,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1232, 185.44223, -1646.36365, 14.82135,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(726, 214.40820, -1697.15430, 7.31233,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(726, 189.51849, -1686.04993, 11.70440,   0.00000, 0.00000, 75.00000);
    CreateDynamicObject(621, 200.59351, -1685.66040, 10.80960,   0.00000, 0.00000, 43.00000);
    CreateDynamicObject(747, 208.10696, -1668.08545, 7.76816,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(747, 161.79315, -1625.66064, 12.71844,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(747, 150.16742, -1637.30957, 11.81544,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(747, 153.10609, -1636.31689, 12.06173,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(620, 212.04350, -1678.58484, 10.46116,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(621, 241.87660, -1708.56921, 5.94267,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(8620, 184.12759, -1638.18665, 36.01915,   0.00000, 0.00000, 309.74936);
    CreateDynamicObject(1232, 188.40480, -1639.77380, 12.00000,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1232, 183.41521, -1633.38086, 12.00000,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(7922, 186.95750, -1641.88464, 12.82600,   0.00000, 270.00000, 218.68930);
    CreateDynamicObject(7922, 186.80560, -1641.70508, 12.60000,   0.00000, 90.00000, 38.55370);
    CreateDynamicObject(7922, 185.53011, -1640.11646, 12.60000,   0.00000, 90.00000, 38.55370);
    CreateDynamicObject(7922, 184.26109, -1638.51794, 12.60000,   0.00000, 90.00000, 38.55370);
    CreateDynamicObject(7922, 182.99249, -1636.91699, 12.60000,   0.00000, 90.00000, 38.55370);
    CreateDynamicObject(7922, 181.72749, -1635.32068, 12.60000,   0.00000, 90.00000, 38.55370);
    CreateDynamicObject(7922, 180.48880, -1633.77380, 12.82600,   0.00000, 270.00000, 218.68930);
    CreateDynamicObject(19356, 182.17000, -1636.18372, 12.02600,   0.00000, 0.00000, 308.50000);
    CreateDynamicObject(19356, 186.00771, -1641.00635, 12.02600,   0.00000, 0.00000, 308.50000);
    CreateDynamicObject(19356, 184.73340, -1639.42651, 12.02600,   0.00000, 0.00000, 308.50000);
    CreateDynamicObject(19356, 183.48511, -1637.84229, 12.02600,   0.00000, 0.00000, 308.50000);
    CreateDynamicObject(1232, 171.43465, -1615.71362, 16.01460,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1232, 176.71782, -1623.19348, 16.26388,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1232, 195.11002, -1645.89319, 15.81968,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1232, 201.31827, -1653.96082, 15.06740,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(8392, 127.95464, -1685.43433, 4.32781,   0.00000, 0.00000, 312.01987);
    CreateDynamicObject(5429, 125.20126, -1690.26404, 8.67316,   0.00000, 0.00000, 18.41995);
    CreateDynamicObject(5429, 125.01718, -1643.94641, 8.65207,   0.00000, 0.00000, 57.16159);
    CreateDynamicObject(1949, 116.77621, -1626.04675, 9.18808,   0.00000, 0.00000, 352.01285);
    CreateDynamicObject(1949, 111.73609, -1625.12939, 9.17794,   0.00000, 0.00000, 349.32422);
    CreateDynamicObject(1237, 114.22006, -1625.46509, 9.08430,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1237, 108.71270, -1624.30432, 9.16526,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1237, 119.66312, -1627.01172, 9.16715,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(869, 111.74110, -1636.90137, 10.60183,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(869, 107.95885, -1635.66455, 10.12098,   0.00000, 0.00000, 330.52243);
    CreateDynamicObject(3520, 115.54118, -1637.88159, 10.02438,   0.00000, 0.00000, 312.41589);
    CreateDynamicObject(760, 120.55231, -1696.41760, 10.09523,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(760, 112.54410, -1689.03784, 10.02292,   0.00000, 0.00000, 313.51682);
    CreateDynamicObject(754, 116.58182, -1693.52502, 10.05968,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(754, 120.47305, -1693.38318, 11.21066,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(754, 123.03469, -1699.15845, 9.38382,   0.00000, 0.00000, 322.30685);
    CreateDynamicObject(681, 109.74294, -1686.40491, 9.01894,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(681, 118.31555, -1697.39966, 9.08152,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(679, 118.75843, -1690.54602, 11.22183,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1949, 125.10002, -1705.53137, 7.86216,   0.00000, 0.00000, 19.79751);
    CreateDynamicObject(1949, 120.21815, -1707.12292, 8.06316,   0.00000, 0.00000, 19.79751);
    CreateDynamicObject(1459, 123.19622, -1707.82629, 8.22202,   0.00000, 0.00000, 17.59180);
    CreateDynamicObject(1237, 117.17035, -1707.82935, 8.17141,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1237, 122.62540, -1706.24438, 7.99019,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(1237, 127.91232, -1704.45190, 8.15348,   0.00000, 0.00000, 0.00000);
    CreateDynamicObject(19381, 161.02251, -1647.15942, 15.17000,   0.00000, 90.00000, 39.00000);
    CreateDynamicObject(19381, 167.12869, -1654.61584, 15.15500,   0.00000, 90.00000, 39.00000);
    CreateDynamicObject(19381, 175.24919, -1648.02161, 15.13810,   0.00000, 90.00000, 39.00000);
    CreateDynamicObject(19381, 169.17650, -1640.54700, 15.15810,   0.00000, 90.00000, 39.00000);
    CreateDynamicObject(8558, 168.27660, -1653.78918, 17.77780,   270.00000, 0.00000, 309.00000);
    CreateDynamicObject(19377, 170.48190, -1658.25134, 14.89380,   0.00000, 0.00000, 129.00000);
    CreateDynamicObject(19377, 158.96825, -1643.04150, 14.89380,   0.00000, 0.00000, 129.00000);
    CreateDynamicObject(19377, 177.86050, -1652.27905, 14.89380,   0.00000, 0.00000, 129.00000);
    CreateDynamicObject(19377, 181.25340, -1648.85437, 14.89380,   0.00000, 0.00000, 39.00000);
    CreateDynamicObject(19377, 165.72391, -1637.56628, 14.89380,   0.00000, 0.00000, 129.00000);
    CreateDynamicObject(19377, 172.81911, -1638.43152, 14.89380,   0.00000, 0.00000, 39.00000);

    return 1;
}
